{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "5897dc96_436e020d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2022-12-08T16:42:16Z",
      "side": 1,
      "message": "Using the test steps here, I am running into the same problem with patch as without: VPN-only, Tor-Enabled apps are simply not able to get online at all (they show as blocked unless you turn on Wi-Fi / Mobile Data toggle, depending on which the underlying network uses): https://gitlab.com/CalyxOS/calyxos/-/issues/1081#note_1201669553\n\nMaybe it is a separate problem, but if so, it\u0027s closely-related.",
      "revId": "7c08cefc2bae02aa5171bd5b4e63589a5d77890d",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e7a3c6c6_4108551b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2022-12-08T17:24:57Z",
      "side": 1,
      "message": "Even the original patch is failing this test. I think I am seeing a different but related bug that is preventing the system from realizing that an app is included in a VPN. Too tangled of a mess right now, will postpone till after qpr1 if that works",
      "revId": "7c08cefc2bae02aa5171bd5b4e63589a5d77890d",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "15c0ad91_3ffca0cb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2022-12-08T17:32:32Z",
      "side": 1,
      "message": "^ I want to clarify this though, for when it *is* revisited: the part of the firewall that determines that an app is currently using the VPN transport, as opposed to Wi-Fi or Mobile Data, is not functioning properly for *connected* split-tunnel VPNs (where the user only includes certain apps). The firewall thinks included apps are on Wi-Fi or Mobile Data instead, so they are blocked. You enable Wi-Fi or Mobile Data, and then they get online through the VPN.\n\nSimilarly, you can turn off VPN for a VPN-included app, and *only* have Wi-Fi or Mobile Data on, and the app will still get online. This is technically a leak, too, so this needs work.\n\nAlso to be clear, none of it happens if you include UID 1000 app (e.g. Dynamic System Updates), so affected users still have a workaround.",
      "parentUuid": "e7a3c6c6_4108551b",
      "revId": "7c08cefc2bae02aa5171bd5b4e63589a5d77890d",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "847c2566_7ee9c818",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2022-12-08T18:18:13Z",
      "side": 1,
      "message": "qpr1 has been tagged (4.4.0)",
      "parentUuid": "15c0ad91_3ffca0cb",
      "revId": "7c08cefc2bae02aa5171bd5b4e63589a5d77890d",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e6e3674c_e0400999",
        "filename": "services/core/java/com/android/server/net/NetworkPolicyManagerService.java",
        "patchSetId": 5
      },
      "lineNbr": 4512,
      "author": {
        "id": 1000062
      },
      "writtenOn": "2022-12-08T21:52:24Z",
      "side": 1,
      "message": "I suspect the issues I am seeing are related to the use of getActiveNetwork() here, instead of getActiveNetworkForUid(), but getActiveNetworkForUid() is not exposed. ðŸ˜ž See I75f952e2.\n\nAgain, an app\u0027s active network can be different from the system\u0027s active network, in the case of split tunnel VPNs (some apps included, some not) and we need to be sure we are determining an app\u0027s firewall state based on its actual network, or it won\u0027t be allowed/blocked appropriately.\n\nIs there some other way we can do this? I am not sure how the Binder calling identities work, so it might completely unrelated, but is there a way we could pretend to be the uid in question when we make the getActiveNetwork() call?",
      "revId": "7c08cefc2bae02aa5171bd5b4e63589a5d77890d",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a6b88b7d_4952af7d",
        "filename": "services/core/java/com/android/server/net/NetworkPolicyManagerService.java",
        "patchSetId": 5
      },
      "lineNbr": 4512,
      "author": {
        "id": 1000002
      },
      "writtenOn": "2022-12-08T21:55:30Z",
      "side": 1,
      "message": "yes, context hacking is possible but often frameworks code check the real calling UID and whatnot to avoid exploits",
      "parentUuid": "e6e3674c_e0400999",
      "revId": "7c08cefc2bae02aa5171bd5b4e63589a5d77890d",
      "serverId": "35266860-6252-469c-a67d-185064479fc0"
    }
  ]
}